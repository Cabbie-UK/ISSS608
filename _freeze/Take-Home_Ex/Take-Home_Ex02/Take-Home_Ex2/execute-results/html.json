{
  "hash": "02cc98427fb9a4c9906fdbe187771e9b",
  "result": {
    "markdown": "---\ntitle: \"FishEye Knowldge Graph: Identify Temporal Patterns of individual entities and between entities\"\nsubtitle: \"VAST Chaellenge 2023: Mini-Challenge 2\"\nauthor: \"KB\"\ndate: last-modified\neditor: visual\nexecute:\n  freeze: auto \n  warning: false\nformat:\n  html:\n    code-fold: true\n    code-summary: \"Show the code\"\n    code-line-numbers: true\n    toc-depth: 4\n---\n\n\n(First Published: May 28, 2023)\n\n## Load all relevant packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(igraph, tidygraph, ggraph, visNetwork, lubridate, clock,               tidyverse, graphlayouts,jsonlite)\n```\n:::\n\n\nimport data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc2 <- fromJSON(\"data/mc2_challenge_graph.json\")\n```\n:::\n\n\nExtract the nodes info from mc2 data frame\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc2_nodes <- as_tibble(mc2$nodes) %>%\n  select(id, shpcountry, rcvcountry)\n```\n:::\n\n\n-   id \\-- Name of the company that originated (or received) the shipment\n\n-   shpcountry \\-- Country the company most often associated with when shipping\n\n-   rcvcountry \\-- Country the company most often associated with when receiving\n\nread\n\nWe will store mc2_nodes in rds format for ease of subsequent retrieval. This code need only be executed once and henece. Thereafter we will reload the mc2_nodes dataframe again\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# write_rds(mc2_nodes, \"data/mc2_nodes.rds\")\nmc2_nodes = read_rds(\"data/mc2_nodes.rds\")\n```\n:::\n\n\nExtract the edges info from mc2 data frame\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc2_edges <- as_tibble(mc2$links) %>%\n  select(source, target, arrivaldate, hscode, valueofgoods_omu, volumeteu, weightkg,  valueofgoodsusd)\n```\n:::\n\n\n-   arrivaldate \\-- Date the shipment arrived at port in YYYY-MM-DD format.\n\n-   hscode \\-- Harmonized System code for the shipment. Can be joined with the hscodes table to get additional details.\n\n-   valueofgoods_omu \\-- Customs-declared value of the total shipment, in Oceanus Monetary Units (OMU)\n\n-   volumeteu \\-- The volume of the shipment in 'Twenty-foot equivalent units', roughly how many 20-foot standard containers would be required. (Actual number of containers may have been different as there are 20ft and 40ft standard containers and tankers that do not use containers)\n\n-   weightkg \\-- The weight of the shipment in kilograms (if known)\n\n## Also store the mc2_edge info in native rds format.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#write_rds(mc2_edges, \"data/mc2_edges.rds\")\nmc2_edges <- read_rds(\"data/mc2_edges.rds\") %>%\n  mutate(arrivaldate = as.Date(arrivaldate, format = \"%Y-%m-%d\"))\n```\n:::\n\n\nAggregate the weight information between each pair of notes and by the relationship type\n\nGet summary stats on the edge data frame\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(mc2_edges)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    source             target           arrivaldate            hscode         \n Length:5464378     Length:5464378     Min.   :2028-01-01   Length:5464378    \n Class :character   Class :character   1st Qu.:2029-09-11   Class :character  \n Mode  :character   Mode  :character   Median :2031-04-30   Mode  :character  \n                                       Mean   :2031-05-31                     \n                                       3rd Qu.:2033-02-25                     \n                                       Max.   :2034-12-30                     \n                                                                              \n valueofgoods_omu     volumeteu         weightkg         valueofgoodsusd    \n Min.   :    1100   Min.   :   0.0   Min.   :        0   Min.   :0.000e+00  \n 1st Qu.:  148130   1st Qu.:   0.0   1st Qu.:     3060   1st Qu.:2.682e+04  \n Median :  504485   Median :   0.0   Median :    10300   Median :7.204e+04  \n Mean   : 1665142   Mean   :   1.5   Mean   :    37266   Mean   :8.654e+05  \n 3rd Qu.: 1202560   3rd Qu.:   0.0   3rd Qu.:    19730   3rd Qu.:1.580e+05  \n Max.   :44744530   Max.   :1215.0   Max.   :495492485   Max.   :2.258e+11  \n NA's   :5464097    NA's   :520933                       NA's   :3017844    \n```\n:::\n:::\n\n\nUnderstand the unique values for HS code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhscode_count <- mc2_edges %>%\n  group_by(hscode) %>%\n  summarise(count=n()) %>%\n  ungroup()\n```\n:::\n\n\nAggregate the weight information between each pair of notes and by the date\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc2_edges_aggregated <- mc2_edges  %>%\n  group_by(source, target, arrivaldate) %>%\n  summarise(weight_sum = sum(weightkg),\n            count = n()) %>%\n  filter(source !=target) %>%\n  ungroup()\n```\n:::\n\n\nWe use `tbl_graph()` of **tinygraph** package to build an tidygraph's network graph data.frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc2_graph <- tbl_graph(nodes = mc2_nodes,\n                       edges = mc2_edges_aggregated,\n                       directed = TRUE)\n```\n:::\n\n\nPlot a graph for \"Náutica del Norte Kga Holding\"\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc2_graph %>%\n\n  activate(edges) %>%\n  filter(arrivaldate=='2034-02-12') %>%\n  ggraph(layout = 'stress') +\n  geom_edge_fan(width = .2, color = 'lightblue') +\n  geom_node_point() +\n  coord_fixed() +\n  theme_graph()\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex2_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\ntest graph\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc2_edges %>% filter(!is.null(valueofgoods_omu))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5,464,378 × 8\n   source          target arrivaldate hscode valueofgoods_omu volumeteu weightkg\n   <chr>           <chr>  <date>      <chr>             <dbl>     <dbl>    <int>\n 1 AquaDelight In… Barin… 2034-02-12  630630           141015         0     4780\n 2 AquaDelight In… Barin… 2034-03-13  630630           141015         0     6125\n 3 AquaDelight In… -15045 2028-02-07  470710               NA         0    10855\n 4 AquaDelight In… -15045 2028-02-23  470710               NA         0    11250\n 5 AquaDelight In… -15045 2028-09-11  470710               NA         0    11165\n 6 AquaDelight In… -15045 2028-10-09  470710               NA         0    11290\n 7 AquaDelight In… Océan… 2028-04-12  304890               NA         0     9000\n 8 AquaDelight In… Olas … 2028-06-04  304890               NA         0    19490\n 9 AquaDelight In… Shou … 2028-09-03  303890               NA         0     6865\n10 AquaDelight In… Shou … 2028-09-08  306170               NA         0    19065\n# ℹ 5,464,368 more rows\n# ℹ 1 more variable: valueofgoodsusd <dbl>\n```\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\nReferences\n\n-   Harshita Kanodia (June 2022), IUU Fishing in the Indian Ocean: A Security Threat. Diplomatist, https://diplomatist.com/2022/06/09/lets-catch-the-big-fish/\n\n-   \n",
    "supporting": [
      "Take-Home_Ex2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}