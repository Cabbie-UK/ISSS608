{
  "hash": "63afb263974944f436acec79fea28cd7",
  "result": {
    "markdown": "---\ntitle: \"10 Ternary Plot to display composition of 3 variables\"\nsubtitle: Hands-On Exercise for Week 6\ndate: last-modified\nauthor: \"KB\"\neditor: visual\nexecute:\n  freeze: auto \n  warning: false\nformat:\n  html:\n    code-fold: true\n    code-summary: \"Show the code\"\n    code-line-numbers: true\n    toc-depth: 4\n---\n\n\n(First Published: May 17, 2023)\n\n## 10.1 Learning Outcome\n\nWe will learn how to build ternary plot programmatically using R to visualise and analyse population structure of Singapore.\n\nTernary plots display the distribution and variability of three-part compositional data. (For example, the proportion of aged, economy active and young population or sand, silt, and clay in soil.) It's display is a triangle with sides scaled from 0 to 1. Each side represents one of the three components. A point is plotted so that a line drawn perpendicular from the point to each leg of the triangle intersect at the component values of the point.\n\n## 10.2 Getting Started\n\n### 10.2.1 Install and load the required r libraries\n\nInstall and load the the required R packages. The name and function of the new package that will be used for this exercise is as follow:\n\n-   [**ggtern**](http://www.ggtern.com/), a ggplot extension specially designed to plot ternary diagrams. The package will be used to plot static ternary plots.\n\n::: callout-note\n## Note on ggtern\n\nDue to some technical issue, ggtern is currently not available for downloading via cran. We need to download ggtern from the archive by using the code chunk below. The latest archive version is 3.4.1.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Codes below are used to install ggtern from archive\nrequire(devtools)\ninstall_version(\"ggtern\", version = \"3.4.1\", repos = \"http://cran.us.r-project.org\")\n```\n:::\n\n\n(The codes above to install **ggtern** should only run once)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(plotly)\nlibrary(tidyverse)\nlibrary(ggtern)\n```\n:::\n\n\n### 10.2.2 Import the data\n\nFor the purpose of this hands-on exercise, the [Singapore Residents by Planning AreaSubzone, Age Group, Sex and Type of Dwelling, June 2000-2018](https://www.singstat.gov.sg/find-data/search-by-theme/population/geographic-distribution/latest-data) data will be used. The data set is called *respopagsex2000to2018_tidy.csv* and is in csv file format.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Reading the data into R environment\npop_data <- read_csv(\"data/respopagsex2000to2018_tidy.csv\", show_col_types = FALSE) \n```\n:::\n\n\nNext, use the `mutate()` function of **dplyr** package to derive three new measures, namely: young, active, and old.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Deriving the young, economy active and old measures\nagpop_mutated <- pop_data %>%\n  mutate(`Year` = as.character(Year))%>%\n  spread(AG, Population) %>%\n  mutate(YOUNG = rowSums(.[4:8]))%>%\n  mutate(ACTIVE = rowSums(.[9:16]))  %>%\n  mutate(OLD = rowSums(.[17:21])) %>%\n  mutate(TOTAL = rowSums(.[22:24])) %>%\n  filter(Year == 2018)%>%\n  filter(TOTAL > 0)\n```\n:::\n\n\n## 10.3 Plotting Static Ternary Diagram with **ggtern**\n\nWe can use `ggtern()` function of **ggtern** package to create a simple ternary plot.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Building the static ternary plot\nggtern(data=agpop_mutated,aes(x=YOUNG,y=ACTIVE, z=OLD)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex6a_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nLet's beautify the plot.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Building the static ternary plot\nggtern(data=agpop_mutated, aes(x=YOUNG,y=ACTIVE, z=OLD)) +\n  geom_point() +\n  labs(title=\"Population structure based on Subzones, 2018\") +\n  theme_rgbw()\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex6a_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n## 10.4 Plotting Intereactive Ternary Diagram with **plotly**\n\nWe can create an interactive ternary plot using `plot_ly()` function of **Plotly R**.\n\nüñ±Ô∏èMouse over the dots below to check out the proportion of each population group for the subzones!\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# reusable function for creating annotation object\nlabel <- function(txt) {\n  list(\n    text = txt, \n    x = 0.1, y = 1,\n    ax = 0, ay = 0,\n    xref = \"paper\", yref = \"paper\", \n    align = \"center\",\n    font = list(family = \"serif\", size = 15, color = \"white\"),\n    bgcolor = \"#b3b3b3\", bordercolor = \"black\", borderwidth = 2\n  )\n}\n\n# reusable function for axis formatting\naxis <- function(txt) {\n  list(\n    title = txt, tickformat = \".0%\", tickfont = list(size = 10)\n  )\n}\n\nternaryAxes <- list(\n  aaxis = axis(\"Young\"), \n  baxis = axis(\"Active\"), \n  caxis = axis(\"Old\")\n)\n\n# Initiating a plotly visualization \nplot_ly(\n  agpop_mutated, \n  a = ~YOUNG, \n  b = ~ACTIVE, \n  c = ~OLD,\n  color = I(\"black\"), \n  type = \"scatterternary\",\n  text = ~SZ   # Added this argument to show the name of the subzone\n) %>%\n  layout(\n    annotations = label(\"Ternary Markers\"), \n    ternary = ternaryAxes\n  ) \n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"plotly html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-3bd31e80c5b78de1e9df\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-3bd31e80c5b78de1e9df\">{\"x\":{\"visdat\":{\"2b1c7d1420cf\":[\"function () \",\"plotlyVisDat\"]},\"cur_data\":\"2b1c7d1420cf\",\"attrs\":{\"2b1c7d1420cf\":{\"a\":{},\"b\":{},\"c\":{},\"text\":{},\"color\":[\"black\"],\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"scatterternary\"}},\"layout\":{\"margin\":{\"b\":40,\"l\":60,\"t\":25,\"r\":10},\"annotations\":[{\"text\":\"Ternary Markers\",\"x\":0.1,\"y\":1,\"ax\":0,\"ay\":0,\"xref\":\"paper\",\"yref\":\"paper\",\"align\":\"center\",\"font\":{\"family\":\"serif\",\"size\":15,\"color\":\"white\"},\"bgcolor\":\"#b3b3b3\",\"bordercolor\":\"black\",\"borderwidth\":2},{\"text\":\"Ternary Markers\",\"x\":0.1,\"y\":1,\"ax\":0,\"ay\":0,\"xref\":\"paper\",\"yref\":\"paper\",\"align\":\"center\",\"font\":{\"family\":\"serif\",\"size\":15,\"color\":\"white\"},\"bgcolor\":\"#b3b3b3\",\"bordercolor\":\"black\",\"borderwidth\":2},{\"text\":\"Ternary Markers\",\"x\":0.1,\"y\":1,\"ax\":0,\"ay\":0,\"xref\":\"paper\",\"yref\":\"paper\",\"align\":\"center\",\"font\":{\"family\":\"serif\",\"size\":15,\"color\":\"white\"},\"bgcolor\":\"#b3b3b3\",\"bordercolor\":\"black\",\"borderwidth\":2}],\"ternary\":{\"aaxis\":{\"title\":\"Young\",\"tickformat\":\".0%\",\"tickfont\":{\"size\":10}},\"baxis\":{\"title\":\"Active\",\"tickformat\":\".0%\",\"tickfont\":{\"size\":10}},\"caxis\":{\"title\":\"Old\",\"tickformat\":\".0%\",\"tickfont\":{\"size\":10}}},\"hovermode\":\"closest\",\"showlegend\":false},\"source\":\"A\",\"config\":{\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"data\":[{\"a\":[1330,5880,5430,4930,1960,3580,2170,4570,1150,6130,2030,19180,7100,11210,9260,9430,8710,1440,6480,8280,7210,1550,6830,2990,4350,4010,2770,3430,5500,6780,3170,420,3020,260,1670,1720,2380,1810,800,3100,3880,2470,1940,2810,3780,5610,2050,8740,8520,1130,8270,6600,5980,1970,1860,2860,3410,1760,1650,2960,120,620,6520,10920,10900,10000,6620,12980,3160,6320,3640,3850,1840,1420,1960,130,30,130,90,8490,7330,2990,6460,1200,6550,10340,7850,6780,7450,3670,12190,120,150,4840,3930,5670,4940,8920,13710,19300,11640,2690,20320,7740,2560,1490,2500,150,2360,2110,2940,10,630,2410,6740,2770,20,30,980,360,270,40,370,7380,1110,860,2850,200,100,10,120,180,2440,1230,10,4220,570,0,9370,16820,2440,11730,16130,70,15940,5790,16050,1380,2930,3090,2350,180,4060,3650,110,170,1140,800,10,50,30,2290,960,720,480,320,60,210,600,0,650,30,270,50,470,260,90,4440,9320,2570,8230,1920,550,14340,6670,17850,18300,18460,2460,3770,5230,8460,4580,3820,0,10,740,510,170,10740,35900,22030,470,1650,2870,370,970,3070,2360,1850,1690,1530,2380,2240,1330,7210,2760,710,230,12150,3200,10730,31770,14070,8330,2330,5470,240,7480,1190,320,17730,9990,13540],\"b\":[2770,16970,15700,13300,3620,9600,4650,12580,2410,14580,4360,48300,15570,27340,19350,23190,22610,3560,17330,18000,16800,3280,16220,8330,9350,9370,5900,8010,11410,16640,7850,910,8660,610,3750,4840,6340,5330,1980,7070,10570,7080,5600,7550,9150,14000,4050,16960,19480,2260,15840,12220,12530,3360,3510,4930,5870,3670,3120,5930,370,820,12890,19140,19690,20320,15130,25120,7860,17070,9420,8970,3380,3390,3480,510,190,510,450,24310,18320,7710,16440,2860,15680,28800,18270,15160,19160,8080,26570,280,540,11110,9510,15270,11830,17800,32920,40760,22960,4960,41410,21590,7150,4930,6980,530,6240,5790,6670,40,1250,5500,15070,5990,200,110,2210,690,580,160,960,19220,2050,1490,5370,390,250,100,270,890,6440,3910,230,8830,1290,0,18550,33140,4480,21430,28870,140,28320,10780,28590,4320,6350,7460,7450,520,8820,9150,140,460,2730,1970,70,210,70,6810,2160,1820,1130,890,140,780,1710,100,1980,90,950,160,1180,1140,140,8480,18720,5520,15810,3590,1000,26160,12930,31820,36400,37430,4880,7790,15440,21410,9730,9720,100,120,1790,1190,390,24500,81520,48300,1090,4050,5320,810,2100,7410,5650,4810,4900,4220,6170,6730,3040,16770,8270,1470,430,21000,7640,20770,58380,24020,18380,6640,9140,550,18000,2350,850,34470,25550,34480],\"c\":[730,5480,5960,4780,1200,3360,1300,4800,640,4270,850,15150,3190,9530,5460,5850,7230,1560,4920,3990,5520,260,3600,1990,1340,2100,1430,1660,2110,3400,3240,100,3510,250,970,1840,2780,2350,410,1960,3510,3120,2260,2450,2740,3320,620,2800,3930,430,2220,1890,3590,1070,880,1320,1390,1060,860,1880,110,50,2100,2830,2180,3370,3510,3350,2830,6130,2780,2930,670,1240,750,220,0,30,70,7240,5530,1600,5170,710,2830,7180,4180,3810,5880,2470,5540,10,220,3350,1800,4550,3170,3500,8240,5650,4050,740,7140,6700,2530,2560,2500,160,2150,1830,1460,10,250,1490,5720,1590,20,10,540,130,150,30,280,5760,750,480,1000,140,100,0,70,450,2070,2200,50,1600,300,170,2650,6040,340,3060,2950,40,4160,910,2870,1760,2040,3020,3410,140,2150,3040,0,20,540,510,20,50,0,2700,390,300,320,260,0,300,520,40,830,0,120,40,530,540,0,1260,2500,400,2170,720,180,3250,1590,4160,5990,5410,1210,2360,4480,7430,1970,2700,20,10,200,100,150,5150,17670,9660,180,800,1240,250,580,3120,2010,1310,1710,1810,2260,2350,1040,4900,3260,260,70,2830,2050,3080,6910,3080,4090,1570,700,150,3560,690,210,4740,5330,7770],\"text\":[\"Ang Mo Kio Town Centre\",\"Cheng San\",\"Chong Boon\",\"Kebun Bahru\",\"Sembawang Hills\",\"Shangri-La\",\"Tagore\",\"Townsville\",\"Yio Chu Kang East\",\"Yio Chu Kang West\",\"Bayshore\",\"Bedok North\",\"Bedok Reservoir\",\"Bedok South\",\"Frankel\",\"Kaki Bukit\",\"Kembangan\",\"Siglap\",\"Bishan East\",\"Marymount\",\"Upper Thomson\",\"Brickworks\",\"Bukit Batok Central\",\"Bukit Batok East\",\"Bukit Batok South\",\"Bukit Batok West\",\"Gombak\",\"Guilin\",\"Hillview\",\"Hong Kah North\",\"Alexandra Hill\",\"Alexandra North\",\"Bukit Ho Swee\",\"Bukit Merah\",\"Depot Road\",\"Everton Park\",\"Henderson Hill\",\"Kampong Tiong Bahru\",\"Maritime Square\",\"Redhill\",\"Telok Blangah Drive\",\"Telok Blangah Rise\",\"Telok Blangah Way\",\"Tiong Bahru\",\"Tiong Bahru Station\",\"Bangkit\",\"Dairy Farm\",\"Fajar\",\"Jelebu\",\"Nature Reserve\",\"Saujana\",\"Senja\",\"Anak Bukit\",\"Coronation Road\",\"Farrer Court\",\"Hillcrest\",\"Holland Road\",\"Leedon Park\",\"Swiss Club\",\"Ulu Pandan\",\"Changi Point\",\"Changi West\",\"Choa Chu Kang Central\",\"Choa Chu Kang North\",\"Keat Hong\",\"Peng Siang\",\"Teck Whye\",\"Yew Tee\",\"Clementi Central\",\"Clementi North\",\"Clementi West\",\"Clementi Woods\",\"Faber\",\"Sunset Way\",\"West Coast\",\"Bugis\",\"Cecil\",\"Central Subzone\",\"Tanjong Pagar\",\"Aljunied\",\"Geylang East\",\"Kampong Ubi\",\"Macpherson\",\"Hougang Central\",\"Hougang East\",\"Hougang West\",\"Kangkar\",\"Kovan\",\"Lorong Ah Soo\",\"Tai Seng\",\"Trafalgar\",\"Jurong Gateway\",\"Lakeside\",\"Teban Gardens\",\"Toh Guan\",\"Yuhua East\",\"Yuhua West\",\"Boon Lay Place\",\"Hong Kah\",\"Jurong West Central\",\"Taman Jurong\",\"Wenya\",\"Yunnan\",\"Bendemeer\",\"Boon Keng\",\"Crawford\",\"Geylang Bahru\",\"Kampong Bugis\",\"Kampong Java\",\"Lavender\",\"Tanjong Rhu\",\"Lim Chu Kang\",\"Mandai Estate\",\"Katong\",\"Marine Parade\",\"Mountbatten\",\"Dhoby Ghaut\",\"Fort Canning\",\"Cairnhill\",\"Goodwood Park\",\"Monk's Hill\",\"Newton Circus\",\"Orange Grove\",\"Balestier\",\"Dunearn\",\"Malcolm\",\"Moulmein\",\"Mount Pleasant\",\"Boulevard\",\"Somerset\",\"Tanglin\",\"China Square\",\"Chinatown\",\"Pearl's Hill\",\"People's Park\",\"Flora Drive\",\"Loyang East\",\"Loyang West\",\"Pasir Ris Central\",\"Pasir Ris Drive\",\"Pasir Ris Park\",\"Pasir Ris West\",\"Matilda\",\"Northshore\",\"Punggol Field\",\"Punggol Town Centre\",\"Waterway East\",\"Commonwealth\",\"Dover\",\"Ghim Moh\",\"Holland Drive\",\"Kent Ridge\",\"Margaret Drive\",\"Mei Chin\",\"National University Of S'pore\",\"One North\",\"Pasir Panjang 1\",\"Pasir Panjang 2\",\"Port\",\"Queensway\",\"Singapore Polytechnic\",\"Tanglin Halt\",\"Institution Hill\",\"Leonie Hill\",\"One Tree Hill\",\"Oxley\",\"Paterson\",\"Bencoolen\",\"Farrer Park\",\"Kampong Glam\",\"Little India\",\"Mackenzie\",\"Mount Emily\",\"Selegie\",\"Sungei Road\",\"Victoria\",\"Seletar\",\"Admiralty\",\"Sembawang Central\",\"Sembawang East\",\"Sembawang North\",\"Sembawang Springs\",\"Sembawang Straits\",\"Anchorvale\",\"Compassvale\",\"Fernvale\",\"Rivervale\",\"Sengkang Town Centre\",\"Lorong Chuan\",\"Seletar Hills\",\"Serangoon Central\",\"Serangoon Garden\",\"Serangoon North\",\"Upper Paya Lebar\",\"Boat Quay\",\"Clarke Quay\",\"Robertson Quay\",\"Sentosa\",\"Turf Club\",\"Simei\",\"Tampines East\",\"Tampines West\",\"Xilin\",\"Chatsworth\",\"Nassim\",\"Ridout\",\"Tyersall\",\"Boon Teck\",\"Braddell\",\"Joo Seng\",\"Kim Keat\",\"Lorong 8 Toa Payoh\",\"Pei Chun\",\"Potong Pasir\",\"Sennett\",\"Toa Payoh Central\",\"Toa Payoh West\",\"Woodleigh\",\"Western Water Catchment\",\"Midview\",\"North Coast\",\"Woodgrove\",\"Woodlands East\",\"Woodlands South\",\"Woodlands West\",\"Khatib\",\"Lower Seletar\",\"Nee Soon\",\"Northland\",\"Springleaf\",\"Yishun Central\",\"Yishun East\",\"Yishun South\",\"Yishun West\"],\"type\":\"scatterternary\",\"mode\":\"markers\",\"marker\":{\"color\":\"rgba(0,0,0,1)\",\"line\":{\"color\":\"rgba(0,0,0,1)\"}},\"textfont\":{\"color\":\"rgba(0,0,0,1)\"},\"line\":{\"color\":\"rgba(0,0,0,1)\"},\"frame\":null}],\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n::: {style=\"text-align: center\"}\n$**That's$ $all$ $folks!**$\n:::\n",
    "supporting": [
      "Hands-On_Ex6a_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.6.2/htmlwidgets.js\"></script>\r\n<script src=\"../../site_libs/plotly-binding-4.10.1/plotly.js\"></script>\r\n<script src=\"../../site_libs/typedarray-0.1/typedarray.min.js\"></script>\r\n<script src=\"../../site_libs/jquery-3.5.1/jquery.min.js\"></script>\r\n<link href=\"../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\r\n<link href=\"../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/plotly-main-2.11.1/plotly-latest.min.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}