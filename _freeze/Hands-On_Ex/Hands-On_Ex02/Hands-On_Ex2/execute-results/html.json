{
  "hash": "2ac1e7489a2d75faee22255836d8256c",
  "result": {
    "markdown": "---\ntitle: \"Beyond ggplot2 Fundamentals\"\neditor: visual\nauthor: \"KB\"\nexecute:\n  freeze: auto \n  warning: false\nformat:\n  html:\n    code-fold: true\n    code-summary: \"Show the code\"\n    code-line-numbers: true\n---\n\n\nPublished: 20-Apr-2023\n\nModified: 27-Apr-2023\n\n## 2.1 Learning Outcome\n\nWe will learn to plot charts that are beyond the out-of-the-box offerings from ggplot2. We will explore how to customize and extend ggplot2 with new:\n\n-   Annotations\n\n-   Themes\n\n-   Composite plots\n\n## 2.2 Getting Started\n\n### 2.2.1 Install and load the required r libraries\n\nInstall and load the the required R packages. The name and function of the *new* packages that will be used for this exercise are as follow:\n\n-   [**ggrepel**:](https://cran.r-project.org/web/packages/ggrepel/vignettes/ggrepel.html) provides a way to prevent labels from overlapping in ggplot2 plots\n\n-   [**ggthemes**](https://mran.microsoft.com/snapshot/2017-02-04/web/packages/ggthemes/vignettes/ggthemes.html): provides a set of additional themes, geoms and scales for ggplot2\n\n-   [**hrbrthemes**](https://gitlab.com/hrbrmstr/hrbrthemes)üëçüèæ: provides another set of visually appealing themes and formatting options for ggplot2\n\n-   [**patchwork**](https://patchwork.data-imaginist.com/)üëçüèæ: provides a way to combine multiple ggplot2 plots into a single figure\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, patchwork, \n               ggthemes, hrbrthemes,\n               ggrepel)\n```\n:::\n\n\n### 2.2.2 Import the data\n\nWe will be using the same exam scores data-set that was featured in my [Hands-On Ex 1](https://boomie-boom-isss608.netlify.app/hands-on_ex/hands-on_ex01/hands-on_ex1#import-the-data \"Additional info on the data-set\").\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexam_data <- read_csv('data/Exam_data.csv', show_col_types = FALSE )\n```\n:::\n\n\n## 2.3 Beyond ggplot2 Annotation\n\nOne challenge in plotting statistical graph is annotation, especially with large number of data points. The data points overlap and this leads to an ugly chart.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data=exam_data, \n       aes(x= MATHS, \n           y=ENGLISH)) +\n  geom_point() +\n  geom_smooth(method=lm, \n              linewidth=0.5) +  \n  geom_label(aes(label = ID), \n             hjust = .5, \n             vjust = -.5) +\n  coord_cartesian(xlim=c(0,100),\n                  ylim=c(0,100)) +\n  ggtitle(\"English scores versus Maths scores for Primary 3\")\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n### 2.3.1 Working with ggrepel package\n\n[**ggrepel**](https://ggrepel.slowkow.com/index.html) is an extension of **ggplot2** package which provides `geoms` for **ggplot2** to repel overlapping text. We simply replace `geom_text()` by [`geom_text_repel()`](https://ggrepel.slowkow.com/reference/geom_text_repel.html) and `geom_label()` by [`geom_label_repel`](https://ggrepel.slowkow.com/reference/geom_text_repel.html)`()`.\n\n`geom_text_repel()` adds text directly to the plot. `geom_label_repel()` draws a rectangle underneath the text, making it easier to read.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data=exam_data, \n       aes(x= MATHS, \n           y=ENGLISH)) +\n  geom_point() +\n  geom_smooth(method=lm, \n              linewidth=0.5) +  \n  geom_label_repel(aes(label = ID), \n                   fontface = \"bold\") +\n  coord_cartesian(xlim=c(0,100),\n                  ylim=c(0,100)) +\n  ggtitle(\"English scores versus Maths scores for Primary 3\")\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n## 2.4 Beyond ggplot2 Themes\n\nggplot2 comes with eight [built-in themes](https://ggplot2.tidyverse.org/reference/ggtheme.html), they are: `theme_gray()`, `theme_bw()`, `theme_classic()`, `theme_dark()`, `theme_light()`, `theme_linedraw()`, `theme_minimal()`, and `theme_void()`. 4 of these themes were featured in my [Hands-On-Ex1 page](https://boomie-boom-isss608.netlify.app/hands-on_ex/hands-on_ex01/hands-on_ex1#the-theme-layer).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data=exam_data, \n             aes(x = MATHS)) +\n  geom_histogram(bins=20, \n                 boundary = 100,\n                 color=\"grey25\", \n                 fill=\"grey90\") +\n  theme_gray() +  \n  ggtitle(\"Distribution of Maths scores [theme_gray()]\") \n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n::: callout-tip\n## For facet or small multiple plots\n\nConsider using `theme_gray(),` `theme_bw()` or `theme_light()` as they offer bounded axis which helps to compartmentalize the different plots.\n:::\n\n### 2.4.1 Working with ggthemes package\n\n[**ggthemes**](https://cran.r-project.org/web/packages/ggthemes/index.html) provides ['ggplot2' themes](https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/) that replicate the look of plots by Edward Tufte, Stephen Few, [Fivethirtyeight](https://fivethirtyeight.com/), [The Economist](https://www.economist.com/graphic-detail), 'Stata', 'Excel', and [The Wall Street Journal](https://www.pinterest.com/wsjgraphics/wsj-graphics/), among others.\n\nCheck out some of the available themes below üëáüèº.\n\n::: panel-tabset\n## Tufte\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- ggplot(data=exam_data, \n             aes(x = MATHS)) +\n  geom_histogram(bins=20, \n                 boundary = 100,\n                 color=\"grey25\", \n                 fill=\"grey90\") +\n  ggtitle(\"Distribution of Maths scores\") +\n  theme_ipsum()\n\np1 + theme_tufte()\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n## Economist\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 +theme_economist() + scale_colour_economist()\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n## (Stephen) Few üëçüèæ\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 + theme_few() + scale_colour_few()\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n## Fivethirtyeight\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 + scale_color_fivethirtyeight(\"cyl\") + theme_fivethirtyeight()\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n## GDocs üëçüèæ\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 + theme_gdocs() + scale_color_gdocs()\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n## Highcharts üëçüèæ\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 + theme_hc() + scale_colour_hc()\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n:::\n\nThe package also provides some extra geoms and scales for 'ggplot2'. Consult [this vignette](https://mran.microsoft.com/snapshot/2016-12-28/web/packages/ggthemes/vignettes/ggthemes.html) to learn more.\n\n### 2.4.2 Working with hrbthems package\n\n[**hrbrthemes**](https://cinc.rud.is/web/packages/hrbrthemes/) package provides a base theme that focuses on typographic elements, including where various labels are placed as well as the fonts that are used.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data=exam_data, \n             aes(x = MATHS)) +\n  geom_histogram(bins=20, \n                 boundary = 100,\n                 color=\"grey25\", \n                 fill=\"grey90\") +\n  ggtitle(\"Distribution of Maths scores\") +\n  theme_ipsum()\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nThe second goal centers around productivity for a production workflow. In fact, this \"production workflow\" is the context for where the elements of hrbrthemes should be used. It allows us, the data analysts, to focus on the analysis while the package works behind the scene to produce an elegant chart. Consult [this vignette](https://cran.r-project.org/web/packages/hrbrthemes/vignettes/why_hrbrthemes.html) to learn more.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data=exam_data, \n             aes(x = MATHS)) +\n  geom_histogram(bins=20, \n                 boundary = 100,\n                 color=\"grey25\", \n                 fill=\"grey90\") +\n  ggtitle(\"Distribution of Maths scores\") +\n  theme_ipsum(axis_title_size = 18, \n              base_size = 15, \n              grid = \"Y\") \n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n::: callout-note\n## Tweaking the arguments in the theme_ipsum() function\n\n-   `axis_title_size` argument is used to increase the font size of the axis title to 18,\n\n-   `base_size` argument is used to increase the default axis label to 15, and\n\n-   `grid` argument is used to remove the x-axis grid lines.\n:::\n\n## 2.5 Beyond ggplot2 facet\n\nIt is not unusual that multiple graphs are required to tell a compelling visual story. There are several ggplot2 extensions provide functions to compose a figure with multiple graphs. In this section, we will learn how to create a composite plot by combining multiple graphs. First, let us create three statistical graphs.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- ggplot(data=exam_data, \n             aes(x = MATHS)) +\n  geom_histogram(bins=20, \n                 boundary = 100,\n                 color=\"grey25\", \n                 fill=\"grey90\") + \n  coord_cartesian(xlim=c(0,100)) +\n  ggtitle(\"Distribution of Maths scores\")\n\np2 <- ggplot(data=exam_data, \n             aes(x = ENGLISH)) +\n  geom_histogram(bins=20, \n                 boundary = 100,\n                 color=\"grey25\", \n                 fill=\"grey90\") +\n  coord_cartesian(xlim=c(0,100)) +\n  ggtitle(\"Distribution of English scores\")\n\np3 <- ggplot(data=exam_data, \n             aes(x= MATHS, \n                 y=ENGLISH)) +\n  geom_point() +\n  geom_smooth(method=lm, \n              size=0.5) +  \n  coord_cartesian(xlim=c(0,100),\n                  ylim=c(0,100)) +\n  ggtitle(\"English scores versus Maths scores for Primary 3\")\n\n\np1\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-14-1.png){width=576}\n:::\n\n```{.r .cell-code}\np2\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-14-2.png){width=576}\n:::\n\n```{.r .cell-code}\np3\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-14-3.png){width=576}\n:::\n:::\n\n\n### 2.5.1 Creating Composite Graphics with pathwork package\n\nThere are several ggplot2 extensions which provide functions to compose figure with multiple graphs. In this section, we are going to explore [**patchwork**](https://patchwork.data-imaginist.com/index.html).\n\nThe **patchwork** package has a very simple syntax where we can create layouts super easily.\n\n::: panel-tabset\n## Basic layout: Placing 2 plots side-by-side\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\np1 + p2\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n## Default layout: Grid Square\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\np1 + p2 + p3 + p1\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n## Change layout: use plot_layout() function\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\np1 + p2 + p3 + plot_layout(nrow = 3, byrow = FALSE)\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n:::\n\nWe can use `|` to place the plots beside each other, while `/` will stack them\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\np1 + p2 / p3\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\n(p1 / p2) | p3\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n**patchwork** also provides auto-tagging capabilities, in order to identify subplots in text\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\n((p1 / p2) | p3) + \n  plot_annotation(tag_levels = '1')\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\nWe can apply themes to the charts\n\n\n::: {.cell fig.asp='0.618'}\n\n```{.r .cell-code}\npatchwork <- (p1 / p2) | p3\npatchwork & theme_economist()\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-21-1.png){width=1344}\n:::\n:::\n\n\nBeside providing functions to place plots next to each other based on the provided layout. With [`inset_element()`](https://patchwork.data-imaginist.com/reference/inset_element.html) of **patchwork**, we can place one or several plots or graphic elements freely on top of another plot.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np3 + inset_element(p2, \n                   left = 0.02, \n                   bottom = 0.7, \n                   right = 0.5, \n                   top = 1.)\n```\n\n::: {.cell-output-display}\n![](Hands-On_Ex2_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\nRefer to [Plot Assembly](https://patchwork.data-imaginist.com/articles/guides/assembly.html) to learn more about arranging charts using **patchwork**.\n\n## 2.6 References\n\n-   [Patchwork R package goes nerd viral](https://www.littlemissdata.com/blog/patchwork)\n\n-   [ggrepel](https://ggrepel.slowkow.com/index.html)\n\n-   [ggthemes](https://ggplot2.tidyverse.org/reference/ggtheme.html)\n\n-   [hrbrthemes](https://cinc.rud.is/web/packages/hrbrthemes/)\n\n-   [ggplot tips: Arranging plots](https://albert-rapp.de/post/2021-10-28-extend-plot-variety/)\n\n-   [ggplot2 Theme Elements Demonstration](https://henrywang.nl/ggplot2-theme-elements-demonstration/)\n\n-   [ggplot2 Theme Elements Reference Sheet](https://isabella-b.com/blog/ggplot2-theme-elements-reference/)\n\n::: {style=\"text-align: center\"}\n$**That's$ $all$ $folks!**$\n:::\n",
    "supporting": [
      "Hands-On_Ex2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}