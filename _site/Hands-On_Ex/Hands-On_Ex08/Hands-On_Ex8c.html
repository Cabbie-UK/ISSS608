<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="KB">
<meta name="dcterms.date" content="2023-06-10">

<title>KB’s Visual Analytics - 17 Analytical Mapping on Choropleth</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../Hands-On_Ex/Hands-On_Ex09/Hands-On_Ex9.html" rel="next">
<link href="../../Hands-On_Ex/Hands-On_Ex08/Hands-on_Ex8b.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">KB’s Visual Analytics</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">Hands-on Exercises</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex01/Hands-on_Ex1.html">
 <span class="dropdown-text">1 A Layered Grammar of Graphics - ggplot2 methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex02/Hands-on_Ex2.html">
 <span class="dropdown-text">2 Beyond ggplot2 Fundamentals</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex03/Hands-on_Ex3a.html">
 <span class="dropdown-text">3 Programming Interactive Data Visualisations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex03/Hands-on_Ex3b.html">
 <span class="dropdown-text">4 Programming Animated Data Visualisations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex04/Hands-on_Ex4a.html">
 <span class="dropdown-text">5 Visual Statistical Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex04/Hands-on_Ex4b.html">
 <span class="dropdown-text">6 Visualise Uncertainty</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex04/Hands-on_Ex4c.html">
 <span class="dropdown-text">7 Funnel Plots for Fair Comparison</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex05/Hands-on_Ex5a.html">
 <span class="dropdown-text">8 Visualise Distributions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex05/Hands-on_Ex5b.html">
 <span class="dropdown-text">9 Visualise Network Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex06/Hands-on_Ex6a.html">
 <span class="dropdown-text">10 Ternary Plot to display composition of 3 variables</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex06/Hands-on_Ex6b.html">
 <span class="dropdown-text">11 Visual Correlation Analysis of Numerical and Categorical Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex06/Hands-on_Ex6c.html">
 <span class="dropdown-text">12 Heatmap to visualise Multivariate Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex06/Hands-on_Ex6d.html">
 <span class="dropdown-text">13 Visual Multivariate Analysis with Parallel Coordinates Plot</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex06/Hands-on_Ex6e.html">
 <span class="dropdown-text">14 Treemap Visualisation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex08/Hands-on_Ex8a.html">
 <span class="dropdown-text">15 Choropleth Mapping</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex08/Hands-on_Ex8b.html">
 <span class="dropdown-text">16 Visualise Geospatial Point Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex08/Hands-On_Ex8c.html">
 <span class="dropdown-text">17 Analytical Mapping on Choropleth</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Ex/Hands-On_Ex09/Hands-On_Ex9.html">
 <span class="dropdown-text">18 Information Dashboard Design</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">In-class Exercises</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercises">    
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex01/In-Class_Ex1.html">
 <span class="dropdown-text">1 A Light Makeover of ggplots</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex03/In-Class_Ex3.html">
 <span class="dropdown-text">2 Publishing a Quarto Document</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex04/In-Class_Ex4.html">
 <span class="dropdown-text">3 Quantile–quantile plots</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex05/In-Class_Ex5.html">
 <span class="dropdown-text">4 Working with json files for Network Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Tableau/3_Animation_CrossFiltering.html">
 <span class="dropdown-text">5 Animinated Bubbleplot and Cross-Filtering of Charts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Tableau/4_multivariate_plots.html">
 <span class="dropdown-text">6 Plots for multi-variate analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Tableau/5_time_plots.html">
 <span class="dropdown-text">7 Time Plots</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Tableau/6_geospatial_plots.html">
 <span class="dropdown-text">8 Visualise Geographic Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Tableau/7_Information_Dashboard.html">
 <span class="dropdown-text">9 Information Dashboard</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">Take-home Exercises</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercises">    
        <li>
    <a class="dropdown-item" href="../../Take-Home_Ex/Take-Home_Ex01/Take-Home_Ex1.html">
 <span class="dropdown-text">1.City of Engagement: Demographics and Financial Health of its Residents</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-Home_Ex/Take-Home_Ex02/Take-Home_Ex2.html">
 <span class="dropdown-text">2.FishEye Knowldge Graph: Temporal Patterns of individual entities and between entities</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-Home_Ex/Take-Home_Ex03/Take-Home_Ex3.html">
 <span class="dropdown-text">3.Countering illegal fishing: Identify anomalies in the business groups</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://kaleidoscopic-bunny-isss624.netlify.app/">KB’s GeoSpatial Analytics</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">17 Analytical Mapping on Choropleth</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../" class="sidebar-logo-link">
      <img src="../../dataviz.jpeg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">Home</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">In-class Exercises</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../In-Class_Ex/In-Class_Ex01/In-Class_Ex1.html" class="sidebar-item-text sidebar-link">1 A Light Makeover of ggplots</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../In-Class_Ex/In-Class_Ex03/In-Class_Ex3.html" class="sidebar-item-text sidebar-link">2 Publishing a Quarto Document</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../In-Class_Ex/In-Class_Ex04/In-Class_Ex4.html" class="sidebar-item-text sidebar-link">3 Quantile–quantile plots</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../In-Class_Ex/In-Class_Ex05/In-Class_Ex5.html" class="sidebar-item-text sidebar-link">4 Working with json files for Network Analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Tableau/3_Animation_CrossFiltering.html" class="sidebar-item-text sidebar-link">5 Animinated Bubbleplot and Cross-Filtering of Charts</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Tableau/4_multivariate_plots.html" class="sidebar-item-text sidebar-link">6 Plots for multi-variate analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Tableau/5_time_plots.html" class="sidebar-item-text sidebar-link">7 Time Plots</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Tableau/6_geospatial_plots.html" class="sidebar-item-text sidebar-link">8 Visualise Geographic Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Tableau/7_Information_Dashboard.html" class="sidebar-item-text sidebar-link">9 Information Dashboard</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">Take-home Exercises</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Take-Home_Ex/Take-Home_Ex01/Take-Home_Ex1.html" class="sidebar-item-text sidebar-link">1.City of Engagement: Demographics and Financial Health of its Residents</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Take-Home_Ex/Take-Home_Ex02/Take-Home_Ex2.html" class="sidebar-item-text sidebar-link">2.FishEye Knowldge Graph: Temporal Patterns of individual entities and between entities</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Take-Home_Ex/Take-Home_Ex03/Take-Home_Ex3.html" class="sidebar-item-text sidebar-link">3.Countering illegal fishing: Identify anomalies in the business groups</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Hands-on Exercises</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex01/Hands-on_Ex1.html" class="sidebar-item-text sidebar-link">1 A Layered Grammar of Graphics - ggplot2 methods</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex02/Hands-on_Ex2.html" class="sidebar-item-text sidebar-link">2 Beyond ggplot2 Fundamentals</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex03/Hands-on_Ex3a.html" class="sidebar-item-text sidebar-link">3 Programming Interactive Data Visualisations</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex03/Hands-on_Ex3b.html" class="sidebar-item-text sidebar-link">4 Programming Animated Data Visualisations</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex04/Hands-on_Ex4a.html" class="sidebar-item-text sidebar-link">5 Visual Statistical Analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex04/Hands-on_Ex4b.html" class="sidebar-item-text sidebar-link">6 Visualise Uncertainty</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex04/Hands-on_Ex4c.html" class="sidebar-item-text sidebar-link">7 Funnel Plots for Fair Comparison</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex05/Hands-on_Ex5a.html" class="sidebar-item-text sidebar-link">8 Visualise Distributions</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex05/Hands-on_Ex5b.html" class="sidebar-item-text sidebar-link">9 Visualise Network Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex06/Hands-on_Ex6a.html" class="sidebar-item-text sidebar-link">10 Ternary Plot to display composition of 3 variables</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex06/Hands-on_Ex6b.html" class="sidebar-item-text sidebar-link">11 Visual Correlation Analysis of Numerical and Categorical Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex06/Hands-on_Ex6c.html" class="sidebar-item-text sidebar-link">12 Heatmap to visualise Multivariate Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex06/Hands-on_Ex6d.html" class="sidebar-item-text sidebar-link">13 Visual Multivariate Analysis with Parallel Coordinates Plot</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex06/Hands-on_Ex6e.html" class="sidebar-item-text sidebar-link">14 Treemap Visualisation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex08/Hands-on_Ex8a.html" class="sidebar-item-text sidebar-link">15 Choropleth Mapping</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex08/Hands-on_Ex8b.html" class="sidebar-item-text sidebar-link">16 Visualise Geospatial Point Data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex08/Hands-On_Ex8c.html" class="sidebar-item-text sidebar-link active">17 Analytical Mapping on Choropleth</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-On_Ex/Hands-On_Ex09/Hands-On_Ex9.html" class="sidebar-item-text sidebar-link">18 Information Dashboard Design</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">Tableau</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Tableau/1_Superstore.html" class="sidebar-item-text sidebar-link">Superstore Annual Sales and Profit</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Tableau/2_Superstore_Story.html" class="sidebar-item-text sidebar-link">The Superstore Story</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learning-outcome" id="toc-learning-outcome" class="nav-link active" data-scroll-target="#learning-outcome">17.1 Learning Outcome</a></li>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started">17.2 Getting Started</a>
  <ul>
  <li><a href="#install-and-load-the-required-r-libraries" id="toc-install-and-load-the-required-r-libraries" class="nav-link" data-scroll-target="#install-and-load-the-required-r-libraries">17.2.1 Install and load the required R libraries</a></li>
  <li><a href="#import-the-data" id="toc-import-the-data" class="nav-link" data-scroll-target="#import-the-data">17.2.2 Import the data</a></li>
  </ul></li>
  <li><a href="#basic-choropleth-mapping" id="toc-basic-choropleth-mapping" class="nav-link" data-scroll-target="#basic-choropleth-mapping"><strong>17.3 Basic Choropleth Mapping</strong></a>
  <ul>
  <li><a href="#visualising-distribution-of-non-functional-water-point" id="toc-visualising-distribution-of-non-functional-water-point" class="nav-link" data-scroll-target="#visualising-distribution-of-non-functional-water-point"><strong>17.3.1 Visualising distribution of non-functional water point</strong></a></li>
  </ul></li>
  <li><a href="#choropleth-map-for-rates" id="toc-choropleth-map-for-rates" class="nav-link" data-scroll-target="#choropleth-map-for-rates"><strong>17.4 Choropleth Map for Rates</strong></a>
  <ul>
  <li><a href="#derive-proportion-of-functional-water-points-and-non-functional-water-points" id="toc-derive-proportion-of-functional-water-points-and-non-functional-water-points" class="nav-link" data-scroll-target="#derive-proportion-of-functional-water-points-and-non-functional-water-points"><strong>17.4.1 Derive Proportion of Functional Water Points and Non-Functional Water Points</strong></a></li>
  <li><a href="#plott-map-of-rate" id="toc-plott-map-of-rate" class="nav-link" data-scroll-target="#plott-map-of-rate"><strong>17.4.2 Plott map of rate</strong></a></li>
  </ul></li>
  <li><a href="#extreme-value-maps" id="toc-extreme-value-maps" class="nav-link" data-scroll-target="#extreme-value-maps"><strong>17.5 Extreme Value Maps</strong></a>
  <ul>
  <li><a href="#percentile-map" id="toc-percentile-map" class="nav-link" data-scroll-target="#percentile-map"><strong>17.5.1 Percentile Map</strong></a>
  <ul class="collapse">
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">17.5.1.1 Data Preparation</a></li>
  <li><a href="#create-the-get.var-function" id="toc-create-the-get.var-function" class="nav-link" data-scroll-target="#create-the-get.var-function">Create the get.var function</a></li>
  <li><a href="#a-percentile-mapping-function" id="toc-a-percentile-mapping-function" class="nav-link" data-scroll-target="#a-percentile-mapping-function">A percentile mapping function</a></li>
  <li><a href="#test-drive-the-percentile-mapping-function" id="toc-test-drive-the-percentile-mapping-function" class="nav-link" data-scroll-target="#test-drive-the-percentile-mapping-function">Test drive the percentile mapping function</a></li>
  </ul></li>
  <li><a href="#box-map" id="toc-box-map" class="nav-link" data-scroll-target="#box-map"><strong>17.5.2 Box map</strong></a>
  <ul class="collapse">
  <li><a href="#creating-the-boxbreaks-function" id="toc-creating-the-boxbreaks-function" class="nav-link" data-scroll-target="#creating-the-boxbreaks-function">17.5.2.1 Creating the boxbreaks function</a></li>
  <li><a href="#creating-the-get.var-function" id="toc-creating-the-get.var-function" class="nav-link" data-scroll-target="#creating-the-get.var-function">17.5.2.2 Creating the get.var function</a></li>
  <li><a href="#test-drive-the-newly-created-function" id="toc-test-drive-the-newly-created-function" class="nav-link" data-scroll-target="#test-drive-the-newly-created-function">17.5.2.3 Test drive the newly created function</a></li>
  <li><a href="#boxmap-function" id="toc-boxmap-function" class="nav-link" data-scroll-target="#boxmap-function">17.5.2.4 Boxmap function</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">17 Analytical Mapping on Choropleth</h1>
<p class="subtitle lead">Hands-On Exercise for Week 8</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>KB </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 10, 2023</p>
    </div>
  </div>
    
  </div>
  

</header>

<p>(First Published: Jun 10, 2023)</p>
<section id="learning-outcome" class="level2">
<h2 class="anchored" data-anchor-id="learning-outcome">17.1 Learning Outcome</h2>
<p>We will gain hands-on experience on using appropriate R methods to plot analytical map. In this class exercise, we will be able to use appropriate functions of <strong>tmap</strong> and <strong>tidyverse</strong> to perform the following tasks:</p>
<ul>
<li><p>Importing geospatial data in rds format into R environment.</p></li>
<li><p>Creating cartographic quality choropleth maps by using appropriate tmap functions.</p></li>
<li><p>Creating rate map</p></li>
<li><p>Creating percentile map</p></li>
<li><p>Creating boxmap</p></li>
</ul>
</section>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">17.2 Getting Started</h2>
<section id="install-and-load-the-required-r-libraries" class="level3">
<h3 class="anchored" data-anchor-id="install-and-load-the-required-r-libraries">17.2.1 Install and load the required R libraries</h3>
<p>Install and load the the required R packages.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tmap, tidyverse, sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="import-the-data" class="level3">
<h3 class="anchored" data-anchor-id="import-the-data">17.2.2 Import the data</h3>
<p>A prepared data set called <em>NGA_wp.rds</em> will be used. The data set is a polygon feature data frame providing information on water point of Nigeria at the LGA level.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>NGA_wp <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/NGA_wp.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="basic-choropleth-mapping" class="level2">
<h2 class="anchored" data-anchor-id="basic-choropleth-mapping"><strong>17.3 Basic Choropleth Mapping</strong></h2>
<section id="visualising-distribution-of-non-functional-water-point" class="level3">
<h3 class="anchored" data-anchor-id="visualising-distribution-of-non-functional-water-point"><strong>17.3.1 Visualising distribution of non-functional water point</strong></h3>
<p>First, we plot a choropleth map showing the distribution of functional and non-function water point by LGA</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(NGA_wp) <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">tm_fill</span>(<span class="st">"wp_functional"</span>,</span>
<span id="cb3-3"><a href="#cb3-3"></a>          <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb3-4"><a href="#cb3-4"></a>          <span class="at">style =</span> <span class="st">"equal"</span>,</span>
<span id="cb3-5"><a href="#cb3-5"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>) <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>  <span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="fl">0.1</span>,</span>
<span id="cb3-7"><a href="#cb3-7"></a>             <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Distribution of functional water point by LGAs"</span>,</span>
<span id="cb3-9"><a href="#cb3-9"></a>            <span class="at">legend.outside =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-10"><a href="#cb3-10"></a></span>
<span id="cb3-11"><a href="#cb3-11"></a>p2 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(NGA_wp) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>  <span class="fu">tm_fill</span>(<span class="st">"wp_nonfunctional"</span>,</span>
<span id="cb3-13"><a href="#cb3-13"></a>          <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb3-14"><a href="#cb3-14"></a>          <span class="at">style =</span> <span class="st">"equal"</span>,</span>
<span id="cb3-15"><a href="#cb3-15"></a>          <span class="at">palette =</span> <span class="st">"Reds"</span>) <span class="sc">+</span></span>
<span id="cb3-16"><a href="#cb3-16"></a>  <span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="fl">0.1</span>,</span>
<span id="cb3-17"><a href="#cb3-17"></a>             <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb3-18"><a href="#cb3-18"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Distribution of non-functional water point by LGAs"</span>,</span>
<span id="cb3-19"><a href="#cb3-19"></a>            <span class="at">legend.outside =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-20"><a href="#cb3-20"></a></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="fu">tmap_arrange</span>(p2, p1, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Hands-On_Ex8c_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="choropleth-map-for-rates" class="level2">
<h2 class="anchored" data-anchor-id="choropleth-map-for-rates"><strong>17.4 Choropleth Map for Rates</strong></h2>
<p>In much of our readings we have now seen the importance to map rates rather than counts of things, and that is for the simple reason that water points are not equally distributed in space. That means that if we do not account for how many water points are somewhere, we end up mapping total water point size rather than our topic of interest.</p>
<section id="derive-proportion-of-functional-water-points-and-non-functional-water-points" class="level3">
<h3 class="anchored" data-anchor-id="derive-proportion-of-functional-water-points-and-non-functional-water-points"><strong>17.4.1 Derive Proportion of Functional Water Points and Non-Functional Water Points</strong></h3>
<p>We will tabulate the proportion of functional water points and the proportion of non-functional water points in each LGA. In the following code chunk, <code>mutate(</code>) from <strong>dplyr</strong> package is used to derive two fields, namely <em>pct_functional</em> and <em>pct_nonfunctional</em>.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>NGA_wp <span class="ot">&lt;-</span> NGA_wp <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="fu">mutate</span>(<span class="at">pct_functional =</span> wp_functional<span class="sc">/</span>total_wp) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">mutate</span>(<span class="at">pct_nonfunctional =</span> wp_nonfunctional<span class="sc">/</span>total_wp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plott-map-of-rate" class="level3">
<h3 class="anchored" data-anchor-id="plott-map-of-rate"><strong>17.4.2 Plott map of rate</strong></h3>
<p>We will plot a choropleth map showing the distribution of percentage functional water point by LGA.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">tm_shape</span>(NGA_wp) <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="fu">tm_fill</span>(<span class="st">"pct_functional"</span>,</span>
<span id="cb5-3"><a href="#cb5-3"></a>          <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb5-4"><a href="#cb5-4"></a>          <span class="at">style =</span> <span class="st">"equal"</span>,</span>
<span id="cb5-5"><a href="#cb5-5"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb5-6"><a href="#cb5-6"></a>          <span class="at">legend.hist =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>  <span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="fl">0.1</span>,</span>
<span id="cb5-8"><a href="#cb5-8"></a>             <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Rate map of functional water point by LGAs"</span>,</span>
<span id="cb5-10"><a href="#cb5-10"></a>            <span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Hands-On_Ex8c_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="extreme-value-maps" class="level2">
<h2 class="anchored" data-anchor-id="extreme-value-maps"><strong>17.5 Extreme Value Maps</strong></h2>
<p>Extreme value maps are variations of common choropleth maps where the classification is designed to highlight extreme values at the lower and upper end of the scale, with the goal of identifying outliers. These maps were developed in the spirit of spatializing EDA, i.e., adding spatial features to commonly used approaches in non-spatial EDA (Anselin 1994).</p>
<section id="percentile-map" class="level3">
<h3 class="anchored" data-anchor-id="percentile-map"><strong>17.5.1 Percentile Map</strong></h3>
<p>The percentile map is a special type of quantile map with six specific categories: 0-1%,1-10%, 10-50%,50-90%,90-99%, and 99-100%. The corresponding breakpoints can be derived by means of the base R quantile command, passing an explicit vector of cumulative probabilities as c(0,.01,.1,.5,.9,.99,1). Note that the <strong>begin</strong> and <strong>endpoint</strong> need to be included.</p>
<section id="data-preparation" class="level4">
<h4 class="anchored" data-anchor-id="data-preparation">17.5.1.1 Data Preparation</h4>
<p>Step 1: Exclude records with NA by using the codes below.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>NGA_wp <span class="ot">&lt;-</span> NGA_wp <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="fu">drop_na</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Step 2: Create customised classification and extracting values</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>percent <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">01</span>,.<span class="dv">1</span>,.<span class="dv">5</span>,.<span class="dv">9</span>,.<span class="dv">99</span>,<span class="dv">1</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a>var <span class="ot">&lt;-</span> NGA_wp[<span class="st">"pct_functional"</span>] <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>)</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="fu">quantile</span>(var[,<span class="dv">1</span>], percent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       0%        1%       10%       50%       90%       99%      100% 
0.0000000 0.0000000 0.2169811 0.4791667 0.8611111 1.0000000 1.0000000 </code></pre>
</div>
</div>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>When variables are extracted from an sf data.frame, the geometry is extracted as well. For mapping and spatial manipulation, this is the expected behavior, but many base R functions cannot deal with the geometry. Specifically, the <code>quantile()</code> gives an error. As a result <code>st_set_geomtry(NULL)</code> is used to drop geomtry field.</p>
</div>
</div>
</section>
<section id="create-the-get.var-function" class="level4">
<h4 class="anchored" data-anchor-id="create-the-get.var-function">Create the get.var function</h4>
<p>Firstly, we will write an R function as shown below to extract a variable (i.e.&nbsp;<em>wp_nonfunctional</em>) as a vector out of an sf data.frame.</p>
<ul>
<li><p>arguments:</p>
<ul>
<li><p>vname: variable name (as character, in quotes)</p></li>
<li><p>df: name of sf data frame</p></li>
</ul></li>
<li><p>returns:</p>
<ul>
<li>v: vector with values (without a column name)</li>
</ul></li>
</ul>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>get.var <span class="ot">&lt;-</span> <span class="cf">function</span>(vname,df) {</span>
<span id="cb9-2"><a href="#cb9-2"></a>  v <span class="ot">&lt;-</span> df[vname] <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>)</span>
<span id="cb9-4"><a href="#cb9-4"></a>  v <span class="ot">&lt;-</span> <span class="fu">unname</span>(v[,<span class="dv">1</span>])</span>
<span id="cb9-5"><a href="#cb9-5"></a>  <span class="fu">return</span>(v)</span>
<span id="cb9-6"><a href="#cb9-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="a-percentile-mapping-function" class="level4">
<h4 class="anchored" data-anchor-id="a-percentile-mapping-function">A percentile mapping function</h4>
<p>Next, we will write a percentile mapping function by using the code chunk below.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>percentmap <span class="ot">&lt;-</span> <span class="cf">function</span>(vnam, df, <span class="at">legtitle=</span><span class="cn">NA</span>, <span class="at">mtitle=</span><span class="st">"Percentile Map"</span>){</span>
<span id="cb10-2"><a href="#cb10-2"></a>  percent <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">01</span>,.<span class="dv">1</span>,.<span class="dv">5</span>,.<span class="dv">9</span>,.<span class="dv">99</span>,<span class="dv">1</span>)</span>
<span id="cb10-3"><a href="#cb10-3"></a>  var <span class="ot">&lt;-</span> <span class="fu">get.var</span>(vnam, df)</span>
<span id="cb10-4"><a href="#cb10-4"></a>  bperc <span class="ot">&lt;-</span> <span class="fu">quantile</span>(var, percent)</span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="fu">tm_shape</span>(df) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>  <span class="fu">tm_shape</span>(df) <span class="sc">+</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>     <span class="fu">tm_fill</span>(vnam,</span>
<span id="cb10-9"><a href="#cb10-9"></a>             <span class="at">title=</span>legtitle,</span>
<span id="cb10-10"><a href="#cb10-10"></a>             <span class="at">breaks=</span>bperc,</span>
<span id="cb10-11"><a href="#cb10-11"></a>             <span class="at">palette=</span><span class="st">"Blues"</span>,</span>
<span id="cb10-12"><a href="#cb10-12"></a>          <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"&lt; 1%"</span>, <span class="st">"1% - 10%"</span>, <span class="st">"10% - 50%"</span>, <span class="st">"50% - 90%"</span>, <span class="st">"90% - 99%"</span>, <span class="st">"&gt; 99%"</span>))  <span class="sc">+</span></span>
<span id="cb10-13"><a href="#cb10-13"></a>  <span class="fu">tm_borders</span>() <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> mtitle, </span>
<span id="cb10-15"><a href="#cb10-15"></a>            <span class="at">title.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>,<span class="st">"bottom"</span>))</span>
<span id="cb10-16"><a href="#cb10-16"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="test-drive-the-percentile-mapping-function" class="level4">
<h4 class="anchored" data-anchor-id="test-drive-the-percentile-mapping-function">Test drive the percentile mapping function</h4>
<p>To run the function, type the codes as shown below.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">percentmap</span>(<span class="st">"total_wp"</span>, NGA_wp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Hands-On_Ex8c_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is just a bare bones implementation. Additional arguments such as the title, legend positioning just to name a few of them, could be passed to customise various features of the map.</p>
</div>
</div>
</section>
</section>
<section id="box-map" class="level3">
<h3 class="anchored" data-anchor-id="box-map"><strong>17.5.2 Box map</strong></h3>
<p>In essence, a box map is an augmented quartile map, with an additional lower and upper category. When there are lower outliers, then the starting point for the breaks is the minimum value, and the second break is the lower fence. In contrast, when there are no lower outliers, then the starting point for the breaks will be the lower fence, and the second break is the minimum value (there will be no observations that fall in the interval between the lower fence and the minimum value).</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> NGA_wp,</span>
<span id="cb12-2"><a href="#cb12-2"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb12-3"><a href="#cb12-3"></a>           <span class="at">y =</span> wp_nonfunctional)) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Hands-On_Ex8c_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li><p>Displaying summary statistics on a choropleth map by using the basic principles of boxplot.</p></li>
<li><p>To create a box map, a custom breaks specification will be used. However, there is a complication. The break points for the box map vary depending on whether lower or upper outliers are present.</p></li>
</ul>
<section id="creating-the-boxbreaks-function" class="level4">
<h4 class="anchored" data-anchor-id="creating-the-boxbreaks-function">17.5.2.1 Creating the boxbreaks function</h4>
<p>The code chunk below is an R function that creating break points for a box map.</p>
<ul>
<li><p>arguments:</p>
<ul>
<li><p><em>v</em>: vector with observations</p></li>
<li><p><em>mult</em>: multiplier for IQR (default 1.5)</p></li>
</ul></li>
<li><p>returns:</p>
<ul>
<li>bb: vector with 7 break points compute quartile and fences</li>
</ul></li>
</ul>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>boxbreaks <span class="ot">&lt;-</span> <span class="cf">function</span>(v,<span class="at">mult=</span><span class="fl">1.5</span>) {</span>
<span id="cb13-2"><a href="#cb13-2"></a>  qv <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">quantile</span>(v))</span>
<span id="cb13-3"><a href="#cb13-3"></a>  iqr <span class="ot">&lt;-</span> qv[<span class="dv">4</span>] <span class="sc">-</span> qv[<span class="dv">2</span>]</span>
<span id="cb13-4"><a href="#cb13-4"></a>  upfence <span class="ot">&lt;-</span> qv[<span class="dv">4</span>] <span class="sc">+</span> mult <span class="sc">*</span> iqr</span>
<span id="cb13-5"><a href="#cb13-5"></a>  lofence <span class="ot">&lt;-</span> qv[<span class="dv">2</span>] <span class="sc">-</span> mult <span class="sc">*</span> iqr</span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="co"># initialize break points vector</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>  bb <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode=</span><span class="st">"numeric"</span>,<span class="at">length=</span><span class="dv">7</span>)</span>
<span id="cb13-8"><a href="#cb13-8"></a>  <span class="co"># logic for lower and upper fences</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>  <span class="cf">if</span> (lofence <span class="sc">&lt;</span> qv[<span class="dv">1</span>]) {  <span class="co"># no lower outliers</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>    bb[<span class="dv">1</span>] <span class="ot">&lt;-</span> lofence</span>
<span id="cb13-11"><a href="#cb13-11"></a>    bb[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">floor</span>(qv[<span class="dv">1</span>])</span>
<span id="cb13-12"><a href="#cb13-12"></a>  } <span class="cf">else</span> {</span>
<span id="cb13-13"><a href="#cb13-13"></a>    bb[<span class="dv">2</span>] <span class="ot">&lt;-</span> lofence</span>
<span id="cb13-14"><a href="#cb13-14"></a>    bb[<span class="dv">1</span>] <span class="ot">&lt;-</span> qv[<span class="dv">1</span>]</span>
<span id="cb13-15"><a href="#cb13-15"></a>  }</span>
<span id="cb13-16"><a href="#cb13-16"></a>  <span class="cf">if</span> (upfence <span class="sc">&gt;</span> qv[<span class="dv">5</span>]) { <span class="co"># no upper outliers</span></span>
<span id="cb13-17"><a href="#cb13-17"></a>    bb[<span class="dv">7</span>] <span class="ot">&lt;-</span> upfence</span>
<span id="cb13-18"><a href="#cb13-18"></a>    bb[<span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(qv[<span class="dv">5</span>])</span>
<span id="cb13-19"><a href="#cb13-19"></a>  } <span class="cf">else</span> {</span>
<span id="cb13-20"><a href="#cb13-20"></a>    bb[<span class="dv">6</span>] <span class="ot">&lt;-</span> upfence</span>
<span id="cb13-21"><a href="#cb13-21"></a>    bb[<span class="dv">7</span>] <span class="ot">&lt;-</span> qv[<span class="dv">5</span>]</span>
<span id="cb13-22"><a href="#cb13-22"></a>  }</span>
<span id="cb13-23"><a href="#cb13-23"></a>  bb[<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>] <span class="ot">&lt;-</span> qv[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb13-24"><a href="#cb13-24"></a>  <span class="fu">return</span>(bb)</span>
<span id="cb13-25"><a href="#cb13-25"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="creating-the-get.var-function" class="level4">
<h4 class="anchored" data-anchor-id="creating-the-get.var-function">17.5.2.2 Creating the get.var function</h4>
<p>The code chunk below is an R function to extract a variable as a vector out of an sf data frame.</p>
<ul>
<li><p>arguments:</p>
<ul>
<li><p><em>vname</em>: variable name (as character, in quotes)</p></li>
<li><p><em>df</em>: name of sf data frame</p></li>
</ul></li>
<li><p>returns:</p>
<ul>
<li>v: vector with values (without a column name)</li>
</ul></li>
</ul>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>get.var <span class="ot">&lt;-</span> <span class="cf">function</span>(vname,df) {</span>
<span id="cb14-2"><a href="#cb14-2"></a>  v <span class="ot">&lt;-</span> df[vname] <span class="sc">%&gt;%</span> <span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>)</span>
<span id="cb14-3"><a href="#cb14-3"></a>  v <span class="ot">&lt;-</span> <span class="fu">unname</span>(v[,<span class="dv">1</span>])</span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">return</span>(v)</span>
<span id="cb14-5"><a href="#cb14-5"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="test-drive-the-newly-created-function" class="level4">
<h4 class="anchored" data-anchor-id="test-drive-the-newly-created-function">17.5.2.3 Test drive the newly created function</h4>
<p>Let’s test the newly created function.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>var <span class="ot">&lt;-</span> <span class="fu">get.var</span>(<span class="st">"wp_nonfunctional"</span>, NGA_wp) </span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">boxbreaks</span>(var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -56.5   0.0  14.0  34.0  61.0 131.5 278.0</code></pre>
</div>
</div>
</section>
<section id="boxmap-function" class="level4">
<h4 class="anchored" data-anchor-id="boxmap-function">17.5.2.4 Boxmap function</h4>
<p>The code chunk below is an R function to create a box map.</p>
<ul>
<li><p>arguments:</p>
<ul>
<li><p><em>vnam</em>: variable name (as character, in quotes)</p></li>
<li><p><em>df</em>: simple features polygon layer</p></li>
<li><p><em>legtitle</em>: legend title</p></li>
<li><p><em>mtitle</em>: map title</p></li>
<li><p><em>mult</em>: multiplier for IQR</p></li>
</ul></li>
<li><p>returns:</p>
<ul>
<li>a tmap-element (plots a map)</li>
</ul></li>
</ul>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>boxmap <span class="ot">&lt;-</span> <span class="cf">function</span>(vnam, df, </span>
<span id="cb17-2"><a href="#cb17-2"></a>                   <span class="at">legtitle=</span><span class="cn">NA</span>,</span>
<span id="cb17-3"><a href="#cb17-3"></a>                   <span class="at">mtitle=</span><span class="st">"Box Map"</span>,</span>
<span id="cb17-4"><a href="#cb17-4"></a>                   <span class="at">mult=</span><span class="fl">1.5</span>){</span>
<span id="cb17-5"><a href="#cb17-5"></a>  var <span class="ot">&lt;-</span> <span class="fu">get.var</span>(vnam,df)</span>
<span id="cb17-6"><a href="#cb17-6"></a>  bb <span class="ot">&lt;-</span> <span class="fu">boxbreaks</span>(var)</span>
<span id="cb17-7"><a href="#cb17-7"></a>  <span class="fu">tm_shape</span>(df) <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>    <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9"></a>  <span class="fu">tm_shape</span>(df) <span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>     <span class="fu">tm_fill</span>(vnam,<span class="at">title=</span>legtitle,</span>
<span id="cb17-11"><a href="#cb17-11"></a>             <span class="at">breaks=</span>bb,</span>
<span id="cb17-12"><a href="#cb17-12"></a>             <span class="at">palette=</span><span class="st">"Blues"</span>,</span>
<span id="cb17-13"><a href="#cb17-13"></a>          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"lower outlier"</span>, </span>
<span id="cb17-14"><a href="#cb17-14"></a>                     <span class="st">"&lt; 25%"</span>, </span>
<span id="cb17-15"><a href="#cb17-15"></a>                     <span class="st">"25% - 50%"</span>, </span>
<span id="cb17-16"><a href="#cb17-16"></a>                     <span class="st">"50% - 75%"</span>,</span>
<span id="cb17-17"><a href="#cb17-17"></a>                     <span class="st">"&gt; 75%"</span>, </span>
<span id="cb17-18"><a href="#cb17-18"></a>                     <span class="st">"upper outlier"</span>))  <span class="sc">+</span></span>
<span id="cb17-19"><a href="#cb17-19"></a>  <span class="fu">tm_borders</span>() <span class="sc">+</span></span>
<span id="cb17-20"><a href="#cb17-20"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> mtitle, </span>
<span id="cb17-21"><a href="#cb17-21"></a>            <span class="at">title.position =</span> <span class="fu">c</span>(<span class="st">"left"</span>,</span>
<span id="cb17-22"><a href="#cb17-22"></a>                               <span class="st">"top"</span>))</span>
<span id="cb17-23"><a href="#cb17-23"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="fu">boxmap</span>(<span class="st">"wp_nonfunctional"</span>, NGA_wp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Hands-On_Ex8c_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div style="text-align: center">
<p><span class="math inline">\(**That's\)</span> <span class="math inline">\(all\)</span> <span class="math inline">\(folks!**\)</span></p>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../Hands-On_Ex/Hands-On_Ex08/Hands-on_Ex8b.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">16 Visualise Geospatial Point Data</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../Hands-On_Ex/Hands-On_Ex09/Hands-On_Ex9.html" class="pagination-link">
        <span class="nav-page-text">18 Information Dashboard Design</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>